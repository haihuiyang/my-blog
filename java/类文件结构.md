谈到类文件结构，就要从 `Java` 虚拟机说起。

#### 一、Java虚拟机是一个与语言无关的平台

实现语言无关性的基础是虚拟机和字节码存储格式。 Java 虚拟机不与任何语言绑定，它只与 "Class 文件" 这种特定的二进制文件格式所关联。

任意一门语言都可以按照 Java 虚拟机规范把程序代码编译成 Class 文件，然后在虚拟机上运行。例如：使用 Java 编译器可以把 Java 代码编译成存储字节码的 Class 文件，使用 JRuby等其他语言的编译器一样可以把程序代码编译成 Class 文件，虚拟机并不关心 Class 的来源是何种语言，如下图所示：
![Java虚拟机提供的语言无关性](https://img-blog.csdn.net/20180606215353383?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhaWh1aV95YW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

#### 二、什么是 Class 类文件结构？

**任意一个有效的类或接口所应当满足的格式称为 "Class 文件格式"，实际上它不一定以磁盘文件的形式存在。**

Class 文件是一组以 8 位字节为基础单位的二进制流，各项数据项目严格按照顺序紧凑地排列在 Class 文件之中。当遇到需要占用 8 位字节以上空间的数据项时，则会按照高位在前（Big–Endian）的方式分割成若干个 8 位字节进行存储。

"Class 文件"说白了就是程序代码编码解码的中间结果。将程序代码编译成 Class 文件的过程就是编码，而虚拟机加载 Class 文件的过程就是解码的过程，编码和解码需要严格虚拟机规范。

下面开始详细的介绍 Class 文件格式（这个过程比较枯燥，但是这是了解虚拟机的重要基础之一）：

根据 Java 虚拟机规范的规定，Class 文件格式采用一种类似于 C 语言结构体的伪结构来存储数据，这种伪结构只有两种数据类型：无符号数和表。所以这里先介绍无符号数和表这两个概念：

（1）无符号数
 
- 无符号数属于基本的数据类型，以 `u1、u2、u4、u8` 来分别表示 1 个字节、2 个字节、4 个字节和 8 个字节的无符号数，无符号数可以用来描述数字、索引引用、数量值或者按照 UTF-8 编码构成字符串值。

（2）表

- 表是有多个无符号数或者其他表作为数据项构成的符合数据类型，所有表都习惯性地以 "_info" 结尾。表用于描述有层次关系的复合结构的数据。

Class 文件本质上就是一张表：
![Class文件格式](https://img-blog.csdn.net/20180606231010265?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhaWh1aV95YW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

由于表中存在一些不定项，所以采取了 "size + size 个数据项"的形式来描述，如上图中的 `fields_count` 表示 `field_info` 的个数，其后跟了 `fields_count` 个 `field_info`。

**注：由于这个地方是用 `u2` 即 2 个字节的无符号数来表示个数，那么，假如一个类的 `field` 的个数超过了 2 个字节所能表示的最大值，则该类会编译失败，不过这种情况基本上不可能出现**


1. 魔数和 Class 文件的版本
2. 常量池
3. 访问标志
4. 类索引、父类索引和接口索引集合
5. 字段标集合
6. 方法表集合
7. 属性表集合

#### 三、举例

原理讲了这么多，是时候实践一把了。

具体举例，
java -p ClassName.class
hexdump -C ClassName.class


参考文献：《深入理解java虚拟机》周志明 著.
